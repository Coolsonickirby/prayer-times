<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times Server</title>
    <link rel="stylesheet" href="prayer_times_vertical.css">
    <script src="jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="box">
            <div>
                <div class="header">
                    <h2 id="masjid_name">{masjid_name}</h2>
                    <h2 id="current_date">{current_date}</h2>
                    <h1 id="current_time">X:XX</h1>
                </div>
                <table>
                    <tbody id="prayer_table">
                        <tr>
                            <td>Prayer</td>
                            <td>Adhan</td>
                            <td>Iqama</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="footer">
                <div id="message">
                    {message}
                </div>
            </div>
        </div>
    </div>

    <script>
        var use24 = false;
        var elem = document.getElementById('message'); //YOUR DIV ELEMENT WHICH YOU WANT TO SCROLL
        var scroll_pos = 0; //SETTING INITIAL SCROLL TO 0
        var scroll_speed = 0;
        var refresh_message = false;

        function refreshInformation() {
            $.getJSON("/info", function (data) {
                use24 = data["format"] == "24";

                document.getElementById("masjid_name").innerHTML = data["masjid_name"];
                document.getElementById("current_date").innerHTML = data["current_date"];

                ["fajr", "dhuhr", "asr", "maghrib", "isha"].forEach((prayer) => {
                    let tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td class="salat_name">${prayer}</td>
                        <td>${data[prayer]["adhan"]}</td>
                        <td>${data[prayer]["iqama"]}</td>
                    `;
                    document.getElementById("prayer_table").append(tr);
                });

                let tr = document.createElement("tr");

                tr.innerHTML = `
                    <td class="salat_name">Jum'ah</td>
                    <td>${data["jummah_adhan"]}</td>
                    <td>${data["jummah_iqama"]}</td>
                `;

                document.getElementById("prayer_table").append(tr);


                document.getElementById("message").textContent = data["message"];
                scroll_speed = data["scroll_speed"];
                console.log(data);
            });
        }

        function getTime() {
            let date = new Date();
            let time = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            if (use24) { return time; }

            let res = time.split(":");
            let hours = parseInt(res[0]);
            let am_pm = "AM";

            if (hours >= 12) {
                hours = hours - 12;
                am_pm = "PM";
            }

            if (hours == 0) {
                hours = 12;
            }

            return `${hours}<span class="fade-text">:</span>${res[1].toString().padStart(2, '0')} <span class="am_pm">${am_pm}</span>`;
        }

        setInterval(() => {
            document.getElementById("current_time").innerHTML = getTime();
        }, 1000);

        window.setInterval(function () {
            if (refresh_message) {
                return;
            }

            if (elem.scrollTop >= elem.offsetHeight) {
                refresh_message = true;
                setTimeout(() => {
                    $("#message").fadeOut(500);
                    $("#message").promise().done(function () {
                        $("#message").css('display', 'none');
                        elem.scrollTop = 0;
                        scroll_pos = 0;
                        setTimeout(() => {
                            $("#message").fadeIn(500);
                            refresh_message = false;
                        }, 5000);
                    });
                }, 3000);
            }

            elem.scrollTo({ top: scroll_pos, behavior: 'smooth' });
            scroll_pos += scroll_speed;
        }, 50);

        refreshInformation();
        document.getElementById("current_time").innerHTML = getTime();
    </script>
</body>

</html>